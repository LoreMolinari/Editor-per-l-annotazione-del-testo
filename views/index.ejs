<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RecogitoJS</title>

    <link rel="stylesheet" href="/css/recogito.min.css" />
  </head>
  <body onload="init()">
    <h1>RecogitoJS</h1>
    <div id="content" class="plaintext"></div>

    <button onclick="listAnnotations()">
      Lista Annotazioni (guarda console)
    </button>
    <button onclick="goToFirepad()">Passa all'Editor di testo</button>

    <script src="/js/recogito.min.js"></script>
    <script src="/js/jquery-3.6.3.min.js"></script>
    
    <script>
      var r;

      // init RecogitoJS
      (function () {
        $("#content").load("/text");

        r = Recogito.init({
          content: "content",
          locale: "auto",
          allowEmpty: false,
          widgets: [
            { widget: "COMMENT" },
            {
              widget: "TAG",
              vocabulary: [
                // TAG POSSIBILI
                "Place",
                "Person",
                "Event",
                "Organization",
                "Animal",
              ],
            },
          ],
          relationVocabulary: ["isRelated", "isPartOf", "isSameAs "],
        });

        // events handlers
        r.on("selectAnnotation", function (a) {
          console.log("selected", a);
        });

        r.on("createAnnotation", function (a) {
          console.log("created", a);
        });

        r.on("updateAnnotation", function (annotation, previous) {
          console.log("updated", previous, "with", annotation);
        });

        r.on("cancelSelected", function (annotation) {
          console.log("cancel", annotation);
        });

        // carica le annotazioni seguendo il W3 standard
        // in questo caso farà una fetch (GET) al server che restituisce
        // un array di JSON con le annotazioni
        r.loadAnnotations("/annotations");
      })();

      function listAnnotations() {
        let annotations = r.getAnnotations();

        console.log("listAnnotations", annotations);
        // inviando questo JSON array al server si potrebberò salvare le annotazioni
        // non è possibile modificare il testo, solo annotare, da quanto vedo
      }

      function goToFirepad() {
        location.href = "/exit/recogito";
      }

    </script>
  </body>
</html>
